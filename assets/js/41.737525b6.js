(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{428:function(t,e,a){"use strict";a.r(e);var s=a(28),o=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"multi-rak-gateway-mesh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multi-rak-gateway-mesh"}},[t._v("#")]),t._v(" Multi-RAK Gateway Mesh")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#gateway-a-with-built-in-lora%C2%AE-network-server"}},[t._v("Gateway-A with Built-in LoRa® Network Server")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#gateway-b-with-mqtt-bridge"}},[t._v("Gateway-B with MQTT Bridge")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#external-mqtt-broker-setup"}},[t._v("External MQTT Broker Setup")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#rak-lpwan-node"}},[t._v("RAK LPWAN Node")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#traffic-testing-and-monitoring"}},[t._v("Traffic Testing and Monitoring")])])]),t._v(" "),a("p",[t._v("This section is a sample demonstration on how to interconnect your "),a("strong",[t._v("RAK7249 Macro Outdoor Gateway")]),t._v(" with its "),a("strong",[t._v("Built-in LoRa Network Server")]),t._v(" to another "),a("strong",[t._v("RAK Gateway")]),t._v(" and make an application for the "),a("strong",[t._v("RAK LPWAN Node")]),t._v(". For this sample demonstration, we will be using the RAK811 LPWAN Node.")]),t._v(" "),a("h2",{attrs:{id:"requirements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requirements"}},[t._v("#")]),t._v(" Requirements")]),t._v(" "),a("ol",[a("li",[t._v("RAK811 LPWAN Node")]),t._v(" "),a("li",[t._v("RAK7249 Macro Outdoor Gateway (LoRa® Server in use)")]),t._v(" "),a("li",[t._v("RAK7249 Macro Outdoor Gateway (MQTT Bridge in use)")])]),t._v(" "),a("h1",{attrs:{id:"gateway-a-with-built-in-lora®-network-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gateway-a-with-built-in-lora®-network-server"}},[t._v("#")]),t._v(" Gateway-A with Built-in LoRa® Network Server")]),t._v(" "),a("p",[t._v("This section is the detailed discussion on how to set-up the built-in LoRa® Server for your RAK7249 Marco Outdoor Gateway using the Web Management Platform.")]),t._v(" "),a("p",[t._v("We will first set-up the built-in LoRa®  network server. Before going through the steps, access the Web Management Platform as discussed in the prior section.")]),t._v(" "),a("h2",{attrs:{id:"packet-forwarder-set-up"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#packet-forwarder-set-up"}},[t._v("#")]),t._v(" Packet Forwarder Set-up")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE")]),t._v(" "),a("p",[t._v("For other settings and detailed documentation for this section, browse the "),a("RouterLink",{attrs:{to:"/Knowledge-Hub/Learn/Resources/Web-Management-Platform/#lora®-network"}},[t._v("LoRa® Network")]),t._v(" section of the Web Management Platform document.")],1)]),t._v(" "),a("ol",[a("li",[a("p",[t._v("By navigating through LoRa® Gateway tab-> LoRa® Packet Forwarder-> General Setup, set the Protocol in the drop-down list to "),a("strong",[t._v("Build-in LoRa ® Server")]),t._v(".")])]),t._v(" "),a("li",[a("p",[t._v('You can leave the rest of the settings with their default values. Remember to "'),a("strong",[t._v("Save & Apply")]),t._v('".')])])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/build-in-lora-server.png",width:"100%",caption:"Build-in LoRa Server Protocol in Gateway"}}),t._v(" "),a("h2",{attrs:{id:"configure-the-lora®-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-lora®-server"}},[t._v("#")]),t._v(" Configure the LoRa® Server")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE")]),t._v(" "),a("p",[t._v("For other settings and detailed documentation for this section, browse the "),a("RouterLink",{attrs:{to:"/Knowledge-Hub/Learn/Resources/Web-Management-Platform/#lora®-network"}},[t._v("LoRa® Network")]),t._v(" section of the Web Management Platform document.")],1)]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Navigate through LoRa® Network Server tab -> General and turn-on this feature using the Enable slider.")])]),t._v(" "),a("li",[a("p",[t._v("Select your Region (Frequency Band). For this demonstration, we are going to use "),a("strong",[t._v("EU863-870 frequency band")]),t._v(".")])])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/lora-network-server-general.png",width:"100%",caption:"LoRa Network Server General"}}),t._v(" "),a("h2",{attrs:{id:"register-rak7249-gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#register-rak7249-gateway"}},[t._v("#")]),t._v(" Register RAK7249 Gateway")]),t._v(" "),a("ol",[a("li",[t._v("Navigate through LoRa® Network Server-> Gateway and enter the "),a("strong",[t._v("Gateway EUI")]),t._v(" in the field.")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/adding-gateway-eui.png",width:"100%",caption:"Adding Gateway EUI"}}),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v('By pressing the "'),a("strong",[t._v("Add")]),t._v('" button, you will be redirected into a new tab where you will need to fill the mandatory parameters: '),a("strong",[t._v("Name")]),t._v(" and "),a("strong",[t._v("Description")]),t._v(".")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE")]),t._v(" "),a("p",[t._v("The "),a("strong",[t._v("Latitude")]),t._v(", "),a("strong",[t._v("Longitude")]),t._v(" and "),a("strong",[t._v("Altitude")]),t._v(" parameters are not mandatory. You can leave them for later, or leave them empty if the gateway is not stationary.")])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("If everything is set-up correctly, you should see the same set-up with the image shown below:")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE")]),t._v(" "),a("p",[t._v("In order to see the Last Seen status update you need to refresh the page. There should be a value of a couple of seconds, if so than everything went well. In case there is a message "),a("strong",[t._v("Never Seen")]),t._v(", there is an issue and you best redo the configuration.")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/gateway-successful-add.jpg",width:"100%",caption:"Gateway Successful Adding"}}),t._v(" "),a("h1",{attrs:{id:"gateway-b-with-mqtt-bridge"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gateway-b-with-mqtt-bridge"}},[t._v("#")]),t._v(" Gateway-B with MQTT Bridge")]),t._v(" "),a("p",[t._v("In this section, we will demonstrate on how to point the External RAK7249-B Macro Outdoor Gateway to the built-in LoRa® Server of Gateway-A Macro Outdoor Gateway.")]),t._v(" "),a("h2",{attrs:{id:"packet-forwarder-set-up-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#packet-forwarder-set-up-2"}},[t._v("#")]),t._v(" Packet Forwarder Set-up")]),t._v(" "),a("ol",[a("li",[t._v("By navigating through LoRa® Gateway tab-> LoRa® Packet Forwarder-> General Setup, set the Protocol in the drop-down list to "),a("strong",[t._v("LoRa Gateway MQTT Bridge")]),t._v(".")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/mqtt-bridge-protocol.png",width:"100%",caption:"Set LoRa® Gateway MQTT Bridge Protocol"}}),t._v(" "),a("h2",{attrs:{id:"lora®-gateway-mqtt-bridge"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lora®-gateway-mqtt-bridge"}},[t._v("#")]),t._v(" LoRa®  Gateway MQTT Bridge")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Navigate through "),a("code",[t._v("LoRa® Gateway tab -> LoRa Gateway MQTT Bridge -> General Setup")]),t._v(" and turn on this feature using the "),a("strong",[t._v("Enable")]),t._v(" slider.")])]),t._v(" "),a("li",[a("p",[t._v("Update the credentials needed in the list provided below.")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("MQTT Broker Address")]),t._v(": IP address of Gateway-A")]),t._v(" "),a("li",[a("strong",[t._v("MQTT Broker Port")]),t._v(": By default, its value is 1883. Please update this if it is not.")])])])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/lora-gateway-mqtt-bridge.png",width:"100%",caption:"LoRa® Gateway MQTT Bridge Configuration"}}),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v('After clicking "'),a("strong",[t._v("Save & Apply")]),t._v('", all LoRa® traffic should be redirected via the Bridge of Gateway-B to the MQTT Brocker of Gateway-A.')])]),t._v(" "),a("h2",{attrs:{id:"registering-rak7249-b-in-rak7249-a-s-lora®-network-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#registering-rak7249-b-in-rak7249-a-s-lora®-network-server"}},[t._v("#")]),t._v(" Registering RAK7249-B in RAK7249-A's LoRa® Network Server")]),t._v(" "),a("p",[t._v("This procedure is the same as when you registered RAK7249-A in its built-in LoRa® Network Server. Please refer to the "),a("RouterLink",{attrs:{to:"/Knowledge-Hub/Learn/Resources/Multi-RAK-Gateway-Mesh/#gateway-a-with-built-in-lora®-network-server"}},[t._v("Gateway-A with Built-in LoRa® Network Server")]),t._v(" and repeat the process. The image below is the representation of what your configuration should look like with the two Gateways are added.")],1),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/gateway-list.png",width:"100%",caption:"LoRa® Network Server Gateway List"}}),t._v(" "),a("p",[t._v('You can add more Gateways in the same manner as we did for the two. This is a convenient way to monitor if they are up using the "'),a("strong",[t._v("Last Seen")]),t._v('" feed.')]),t._v(" "),a("h1",{attrs:{id:"external-mqtt-broker-setup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#external-mqtt-broker-setup"}},[t._v("#")]),t._v(" External MQTT Broker Setup")]),t._v(" "),a("p",[t._v("This section provides the procedure in setting the external MQTT Broker for your Application Setup.")]),t._v(" "),a("h2",{attrs:{id:"preparing-the-raspberry-pi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preparing-the-raspberry-pi"}},[t._v("#")]),t._v(" Preparing the Raspberry Pi")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE:")]),t._v(" "),a("p",[t._v("We are going to use going to use a "),a("strong",[t._v("Raspberry Pi 3B+")]),t._v(" for this tutorial, as the device that is going to be hosting Mosquitto (a popular MQTT broker).")])]),t._v(" "),a("ul",[a("li",[t._v("The following items listed below with its download links for the tools and files needed for this demonstration:\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://www.raspberrypi.org/downloads/raspbian/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Raspbian Buster Lite Image"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.balena.io/etcher/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Balena Etcher Tool"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("PuTTY SSH Client"),a("OutboundLink")],1)])])])]),t._v(" "),a("ol",[a("li",[t._v("Download the Raspbian Buster Lite image and flash it into your SD Card using the Balena Etcher. You can follow the steps provided in the Device Firmware Setup section. Once done, plug the SD card into the "),a("strong",[t._v("Raspberry Pi 3B+")]),t._v(" SD card slot and power it.")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE:")]),t._v(" "),a("p",[t._v("It is highly recommended to follow the configurations of "),a("a",{attrs:{href:"https://www.raspberrypi.org/documentation/configuration/wireless/headless.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("Raspberry Pi headless"),a("OutboundLink")],1),t._v(".")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[t._v("Using the PuTTY SSH client, connect to the Raspberry Pi 3B+ with the following credentials:")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Username")]),t._v(": pi")]),t._v(" "),a("li",[a("strong",[t._v("Password")]),t._v(": raspberry")])])]),t._v(" "),a("li",[a("p",[t._v("Execute the following command and note the IP address of the interface you will be using to connect to the network. You will need this, as it will be the address for your MQTT Broker when configuring the Gateway:")])])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ifconfig")]),t._v("\n")])])]),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/rpi-interfaces.jpg",width:"75%",caption:"Raspberry Pi interfaces"}}),t._v(" "),a("h2",{attrs:{id:"installing-mosquitto"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installing-mosquitto"}},[t._v("#")]),t._v(" Installing Mosquitto")]),t._v(" "),a("ol",[a("li",[t._v("Install the MQTT Broker (Mosquitto) via the command:")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" mosquitto mosquitto-clients\n")])])]),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/mqtt-installation.jpg",width:"80%",caption:"Mosquitto installation"}}),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Mosquitto clients help us easily test MQTT through a command line utility. We will use two command windows; one to subscribe to a topic and one to publish a message to it. Those will be explained in detail further in the tutorial.")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE:")]),t._v(" "),a("p",[t._v("This command is not mandatory, however it is recommended as it creates a mosquitto service that will run the broker on startup.")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" mosquitto.service\n")])])]),a("h2",{attrs:{id:"publish-to-the-mqtt-broker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#publish-to-the-mqtt-broker"}},[t._v("#")]),t._v(" Publish to the MQTT Broker")]),t._v(" "),a("p",[t._v("We will now then configure the Gateway to connect to our external MQTT broker. For the purpose of this example, we are going to use the built-in LoRa® Server.")]),t._v(" "),a("ol",[a("li",[t._v("First go to the Packet Forwarder Tab and choose Built-in LoRa® Server as your Protocol:")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/protocol-selection.jpg",width:"100%",caption:"Protocol selection"}}),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Make sure you have the LoRa® Network Server "),a("strong",[t._v("Enabled")]),t._v(" in the General tab:")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/builtin-server-activation.jpg",width:"100%",caption:"Built-in LoRa® Server activation"}}),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Add Your Gateway in the Gateway tab if you haven’t done so already. You can also add multiple gateways depending on your preference.")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/lora-gateway-config.jpg",width:"100%",caption:"LoRa® Server Gateway configuration"}}),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("Finally, go to the "),a("strong",[t._v("Global Integration")]),t._v(" tab and enter the address where you have your Mosquitto instance running in the MQTT Broker Address field leaving the Port with the default "),a("code",[t._v("1883")]),t._v(" value.")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/set-global-integration.jpg",width:"100%",caption:"Setting up the Global Integration"}}),t._v(" "),a("p",[t._v("Now that the Gateway parameters are set, we will now register your application in order to be able to send and receive data. We are going to use the "),a("strong",[t._v("RAK811 LPWAN Node")]),t._v(" as an example in the next sub-section.")]),t._v(" "),a("h2",{attrs:{id:"downlink"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#downlink"}},[t._v("#")]),t._v(" Downlink")]),t._v(" "),a("p",[t._v("There is a convenient tool in the Built-in LoRa® Server for sending a Downlink frame.")]),t._v(" "),a("ol",[a("li",[t._v("You can find it in the Device tab in the LoRa® Network Server section. You can choose your Type of frame ("),a("strong",[t._v("confirmed/unconfirmed")]),t._v("), the Frame port and the Hex Data shown in the image below:")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/downlink.jpg",width:"100%",caption:"LoRa® Network Server Device Downlink tool"}}),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Once you schedule a message for downlink it will be displayed in the Live Device Data window. Upon sending the next uplink via the RAK Serial Port Tool you will also see it there, as it needs an uplink frame in order to send the downlink in the RX1 window shown in the image below.")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/rec-downlink-frm.jpg",width:"100%",caption:"Received Downlink Frame"}}),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("If you want to test the Gateway downlink via the external MQTT Broker, you need to first create a json file which you will be sensing your data in. Below is what the file formatting structure needs to look like:")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE:")]),t._v(" "),a("ul",[a("li",[t._v('"'),a("strong",[t._v("confirmed")]),t._v('": '),a("strong",[t._v("true")]),t._v(" – This is the LoRa® frame type. True (confirmed), False (unconfirmed)")]),t._v(" "),a("li",[t._v('"'),a("strong",[t._v("data")]),t._v('": "'),a("strong",[t._v("TEST")]),t._v('" – example data to be sent')]),t._v(" "),a("li",[t._v('"'),a("strong",[t._v("fPort")]),t._v('": '),a("strong",[t._v("10")]),t._v(" – the Frame Port Number")])])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"confirmed"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"fPort"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"data"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1001"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE:")]),t._v(" "),a("p",[t._v("You need to have a "),a("strong",[t._v("Base64")]),t._v(" encoded "),a("strong",[t._v("HEX data")]),t._v(" for the above to work.")])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("Create the file, for example with the following command and copy the data in discussed above:")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nano")]),t._v(" test.json\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[t._v("After you have created the file, you need to schedule it for downlink. This means that you have to publish it via Mosquitto with the command:")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" mosquito_pub application/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("application_ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("/device/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("device_EUI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/ tx –f test.json\n")])])]),a("ul",[a("li",[t._v("The packet will be scheduled for downlink, which you can see in the Gateway Packet logger.")]),t._v(" "),a("li",[t._v("When the next uplink frame that comes for the Application/Device specified by the "),a("strong",[t._v("application_ID")]),t._v(" and "),a("strong",[t._v("device_EUI")]),t._v(" is received, the Gateway will send the data in the RX1 window to the node. You should have a response similar to the one in "),a("strong",[t._v("Figure 15")]),t._v(".")])]),t._v(" "),a("h1",{attrs:{id:"rak-lpwan-node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rak-lpwan-node"}},[t._v("#")]),t._v(" RAK LPWAN Node")]),t._v(" "),a("p",[t._v("This document discusses the steps on how to add your RAK811 LPWAN Node Application into the Built-in LoRa® Network Server demonstration. For this demonstration, it is best advised to use our very own "),a("a",{attrs:{href:"https://downloads.rakwireless.com/en/LoRa/Tools/",target:"_blank",rel:"noopener noreferrer"}},[t._v("RAK Serial Port Tool"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"register-the-application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#register-the-application"}},[t._v("#")]),t._v(" Register the Application")]),t._v(" "),a("ol",[a("li",[t._v("Connect your RAK811 to your computer by following the "),a("RouterLink",{attrs:{to:"/Product-Categories/WisDuino/RAK811-Evaluation-Board/Quickstart/#what-do-you-need"}},[t._v("Interfacing your RAK811 LPWAN Node")]),t._v(" section or the RAK811 LPWAN Node. Once connecting is successful, open the RAK Serial Port Tool and press the "),a("strong",[t._v("RESET Button (RST)")]),t._v(" to reboot your device to check the LoRa® parameters same with the image shown below:")],1)]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/build-in-lora-server/rak811-parameters.png",width:"100%",caption:"RAK811 LPWAN Node Parameters"}}),t._v(" "),a("ul",[a("li",[t._v("In case your device is already configured to work in OTAA same with the image above, it will attempt connecting to the gateway but does not get authenticated as it is not registered yet and needs to be configured first.")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE")]),t._v(" "),a("p",[t._v("Open the "),a("RouterLink",{attrs:{to:"/Product-Categories/WisDuino/RAK811-Evaluation-Board/Quickstart/#miscellaneous"}},[t._v("AT Commands for RAK811 LPWAN Node")]),t._v(" section of the RAK811 LPWAN Node to check the complete list of AT Commands compatible.")],1)]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Set the Region/Band by plugging in the AT Command below in the RAK Serial Port Tool. For this demonstration, EU868 frequency band shall be used.")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("at+set_config=lora:region:EU868\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Set the authentication mode to OTAA:")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("at+set_config=lora:join_mode:0\n")])])]),a("ul",[a("li",[t._v("Now that your RAK811 LPWAN Node is working in the correct region and mode, you need to fill in the application parameters in your Gateway. This will register the specific device and allow you to exchange data.")])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("Navigate through "),a("code",[t._v("LoRa® Network Server -> Application -> Devices")]),t._v('. Enter a name for your application and press the "'),a("strong",[t._v("Add")]),t._v('" button.')])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/build-in-lora-server/add-application.png",width:"100%",caption:"Adding Application"}}),t._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[t._v("Refer back to the RAK Serial Port Tool shown in "),a("strong",[t._v("Figure 16: RAK811 LPWAN Node Parameters")]),t._v(" and take note the "),a("strong",[t._v("Application EUI")]),t._v(" and "),a("strong",[t._v("Application Key")]),t._v(". Input those into the corresponding fields in the "),a("strong",[t._v("Application Configuration")]),t._v(" screen in the Gateway:")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/build-in-lora-server/set-otaa-parameters.png",width:"100%",caption:"Adding Application EUI and Key"}}),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE")]),t._v(" "),a("p",[t._v('In case your RAK811 LPWAN Node is still not configured, you can manually input an Application EUI and Application Key here or have it randomly generated by clicking the green button at the right side of the input box. You will have these data configured to the RAK811 LPWAN Node using the RAK Serial Port Tool with the commands below. Make sure to change "XXXX" with your equivalent Application EUI and Key.')])]),t._v(" "),a("ul",[a("li",[t._v("Setting the "),a("strong",[t._v("Application EUI")]),t._v(":")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("at+set_config=lora:app_eui:XXXX\n")])])]),a("ul",[a("li",[t._v("Setting the "),a("strong",[t._v("Application Key")]),t._v(":")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('at+set_config=lora:app_key:XXXX"\n')])])]),a("ol",{attrs:{start:"6"}},[a("li",[a("strong",[t._v("Save & Apply")]),t._v(" (Make sure the Auto Add Device Slider is in the off position).")])]),t._v(" "),a("h2",{attrs:{id:"adding-the-device"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-the-device"}},[t._v("#")]),t._v(" Adding the Device")]),t._v(" "),a("ol",[a("li",[t._v('Locate the application created in the previous section and press the "'),a("strong",[t._v("Edit")]),t._v('" button.')])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/build-in-lora-server/edit-applications.png",width:"100%",caption:"Editing the Application"}}),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Enter the "),a("strong",[t._v("Device EUI")]),t._v(' into the corresponding field and press "'),a("strong",[t._v("Add")]),t._v('" button.')])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/build-in-lora-server/add-device-in-application.png",width:"100%",caption:"Adding Device in the Application"}}),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Enter a "),a("strong",[t._v("Device name")]),t._v(", make sure you are in "),a("strong",[t._v("Class A")]),t._v(", "),a("strong",[t._v("OTAA")]),t._v(" mode. Leave the rest of the parameters with their default settings then "),a("strong",[t._v("Save & Apply")]),t._v(".")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/build-in-lora-server/edit-device-parameters.png",width:"100%",caption:"Editing Device Parameters"}}),t._v(" "),a("h2",{attrs:{id:"data-transfer-monitoring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data-transfer-monitoring"}},[t._v("#")]),t._v(" Data Transfer Monitoring")]),t._v(" "),a("p",[t._v("By following the steps in the previous sections, you should now have your Device registered and if you click on the "),a("strong",[t._v("Device EUI")]),t._v(", you will open the corresponding Device window. Go to the "),a("strong",[t._v("Live Device Data")]),t._v(" tab. Here you can monitor data that the application is exchanging in real time.")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE")]),t._v(" "),a("p",[t._v("Keep the Live Device Data tab opened as we want to monitor traffic.")])]),t._v(" "),a("ol",[a("li",[t._v("Using the RAK Serial Port Tool, execute the AT command provided below to reboot the RAK811. Alternatively, you could press the "),a("strong",[t._v("RESET Button (RST)")]),t._v(".")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("at+set_config=device:restart\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Upon reboot, your RAK811 should be able to join via OTAA if all the credentials are authenticated. You should see a "),a("strong",[t._v("Join")]),t._v(" request in the Live Data tab and the "),a("strong",[t._v("Join Succeeded!")]),t._v(" message in the Serial Tool.")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/build-in-lora-server/data-monitoring.png",width:"100%",caption:"Live Device Data Monitoring"}}),t._v(" "),a("h1",{attrs:{id:"traffic-testing-and-monitoring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#traffic-testing-and-monitoring"}},[t._v("#")]),t._v(" Traffic Testing and Monitoring")]),t._v(" "),a("h2",{attrs:{id:"uplink"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uplink"}},[t._v("#")]),t._v(" Uplink")]),t._v(" "),a("p",[t._v("Now your RAK811 LoRa® Node is authenticated with the built-in LoRa® Server. As it is connected to the external MQTT Broker via the Global Integration, you can monitor traffic in both the Live Data tab and on the "),a("strong",[t._v("Raspberry Pi 3B+")]),t._v(" where the Mosquitto resides. Let us test this by sending an uplink frame via the RAK811.")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("In the command line window of the Raspberry Pi 3B+, we need to subscribe to the Application/Device we are going to monitor the traffic. This is done via the following command. Take note of the following syntax in the list below to have the command executed correctly:")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("application_ID")]),t._v(": is the application ID from the Application tab in the Gateway.")]),t._v(" "),a("li",[a("strong",[t._v("device_EUI")]),t._v(": is the Device EUI of the RAK811 LoRa® Node")])])])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("mosquitto_sub -t application/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("application_ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/device/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("device_EUI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/rx -v\n")])])]),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/app-id.jpg",width:"100%",caption:"Application ID"}}),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("After executing the command, you need to send some data via the RAK Serial Port Tool. Use the command below to send an uplink frame on Frame port 1, with the Payload 1110:")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("at+send=lora:1:1110\n")])])]),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/test-uplink.jpg",width:"100%",caption:"Test Uplink (Application)"}}),t._v(" "),a("ul",[a("li",[t._v("Now if you look at the three windows in the image above, in the RAK Serial Port Tool, Live Device Data and the CLI of the Raspberry, you will see that the message arriving is displayed.")])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("You can also monitor the Gateway traffic itself. You can do this via the command. Take note of the following syntax in the list below to have the command executed correctly:")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE")]),t._v(" "),a("p",[t._v("eui: is the Gateway EUI")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("mosquitto_sub -t gateway/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("eui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/rx -v\n")])])]),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/app-test-gateway.jpg",width:"100%",caption:"Test Uplink (Gateway)"}}),t._v(" "),a("ul",[a("li",[t._v("This is very convenient as you have three ways to monitor and you can see the metadata and payload in both the Gateway and via the MQTT Broker.")])]),t._v(" "),a("h2",{attrs:{id:"downlink-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#downlink-2"}},[t._v("#")]),t._v(" Downlink")]),t._v(" "),a("p",[t._v("There is a convenient tool in the Built-in LoRa® Server for sending a Downlink frame.")]),t._v(" "),a("ol",[a("li",[t._v("You can find it in the Device tab in the LoRa® Network Server section. You can choose your Type of frame (confirmed/unconfirmed), the Frame port and the Hex Data shown in the image below:")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/downlink-tool.jpg",width:"100%",caption:"LoRa® Network Server Device Downlink Tool"}}),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Once you schedule a message for downlink, it will be displayed in the Live Device Data window. Upon sending the next uplink via the RAK Serial Port Tool you will also see it there, as it needs an uplink frame in order to send the downlink in the RX1 window shown in the image below.")])]),t._v(" "),a("rk-img",{attrs:{src:"/assets/images/deployment-guide/rak-gateway-mesh/downlink-frame.jpg",width:"100%",caption:"Received Downlink Frame"}}),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("If you want to test the Gateway downlink via the external MQTT Broker, you need to first create a json file which you will be sensing your data in. Below is what the file formatting structure needs to look like:")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE")]),t._v(" "),a("ul",[a("li",[t._v('"'),a("strong",[t._v("confirmed")]),t._v('": '),a("strong",[t._v("true")]),t._v(" – This is the LoRa® frame type. True (confirmed), False (unconfirmed)")]),t._v(" "),a("li",[t._v('"'),a("strong",[t._v("data")]),t._v('": "'),a("strong",[t._v("TEST")]),t._v('" – example data to be sent')]),t._v(" "),a("li",[t._v('"'),a("strong",[t._v("fPort")]),t._v('": '),a("strong",[t._v("10")]),t._v(" – the Frame Port Number")])])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"confirmed"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fPort"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1001"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("📝 NOTE")]),t._v(" "),a("p",[t._v("You need to have a "),a("strong",[t._v("Base64")]),t._v(" encoded "),a("strong",[t._v("HEX data")]),t._v(" for the above to work.")])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("Create the file, for example with the following command and copy the data in discussed above:")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nano")]),t._v(" test.json\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[t._v("After you have created the file, you need to schedule it for downlink. This means that you have to publish it via Mosquitto with the command:")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" mosquito_pub application/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("application_ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("/device/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("device_EUI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/ tx –f test.json\n")])])]),a("ul",[a("li",[t._v("The packet will be scheduled for downlink, which you can see in the Gateway Packet logger.")]),t._v(" "),a("li",[t._v("When the next uplink frame that comes for the Application/Device specified by the "),a("strong",[t._v("application_ID")]),t._v(" and "),a("strong",[t._v("device_EUI")]),t._v(" is received, the Gateway will send the data in the RX1 window to the node. You should have a response similar to the one in "),a("strong",[t._v("Figure 27")]),t._v(".")])])],1)}),[],!1,null,null,null);e.default=o.exports}}]);